#!/usr/bin/env node
var startupCore = process.argv.filter(arg => arg === '--start-core')
var agent = (startupCore.length > 0) ? require('..') : require('../../../agent/lib/agent-runner')

async function exit() {
  await agent.shutdown()
  process.exit(0)
}

process.on('SIGINT', () => {
  exit()
})
process.on('SIGTERM', () => {
  exit()
})

agent.startup().then(ret => {
  if (!ret) {
    process.exit(1)
  }
}).catch(err => {
  console.error(`Agent startup failed: ${err}`)
  process.exit(1)
})
