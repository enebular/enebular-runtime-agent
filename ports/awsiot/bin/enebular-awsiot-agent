#!/usr/bin/env node
var path = require('path')
var startCore = process.argv.filter(arg => arg === '--start-core')
var agent = (startCore.length > 0) ? require('..') : require('../../../agent/lib/runner/index')

async function exit() {
  await agent.shutdown()
  process.exit(0)
}

process.on('SIGINT', () => {
  exit()
})
process.on('SIGTERM', () => {
  exit()
})

agent.startup(path.resolve(__dirname, '../')).then(ret => {
  if (!ret) {
    process.exit(1)
  }
}).catch(err => {
  console.error(`Agent startup failed: ${err}`)
  process.exit(1)
})
