<script type="text/javascript">
    RED.nodes.registerType('interruptin', {
        category: 'EEA',
        color: '#91b122',
        defaults: {
            pinName: { value: 'PTA4' },
            mode: { value: 3 },
            trigger: { value: 'rise' },
            name: { value: '' }
        },
        inputs: 0,
        outputs: 1,
        icon: 'serial.png',
        label: function () {
            return this.name || 'interruptin';
        },
        button: {
            onclick: function () {
                var label = (this.name || 'InterruptIn');
                if (label.length > 30) {
                    label = label.substring(0, 50) + "...";
                }
                label = label.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
                var node = this;
                $.ajax({
                    url: "inject/" + this.id,
                    type: "POST",
                    success: function (resp) {
                        RED.notify(node._("inject.success", { label: label }), "success");
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert("INJECT_ERROR!!!");
                        if (jqXHR.status == 404) {
                            RED.notify(node._("common.notification.error", { message: node._("common.notification.errors.not-deployed") }), "error");
                        } else if (jqXHR.status == 500) {
                            RED.notify(node._("common.notification.error", { message: node._("inject.errors.failed") }), "error");
                        } else if (jqXHR.status == 0) {
                            RED.notify(node._("common.notification.error", { message: node._("common.notification.errors.no-response") }), "error");
                        } else {
                            RED.notify(node._("common.notification.error", { message: node._("common.notification.errors.unexpected", { status: jqXHR.status, message: textStatus }) }), "error");
                        }
                    }
                });
            }
        },
    });
</script>

<script type="text/x-red" data-template-name="interruptin">
    <div class="form-row">
      <label for="node-input-pinname"><i class="fa fa-bolt"></i> pinName</label>
      <select type="text" id="node-input-pinName">
        <option value="PTA4">PTA4</option>
        <option value="PTC4">PTC4</option>
        <option value="PTC6">PTC6</option>
        <option value="PTD0">PTD0</option>
      </select>
    </div>
    <div class="form-row">
      <label for="node-input-mode"><i class="fa fa-toggle-on"></i> mode</label>
      <select type="text" id="node-input-mode">
        <option value=3>pullup</option>
        <option value=1>pulldown</option>
        <option value=0>pullnone</option>
      </select>
    </div>
    <div class="form-row">
      <label for="node-input-trigger"><i class="fa fa-sign-in"></i> trigger</label>
      <select type="text" id="node-input-trigger">
        <option value="rise">rise</option>
        <option value="fall">fall</option>
      </select>
    </div>
    <div class="form-row">
      <label for="node-input-name"><i class="icon-tag"></i> Name</label>
      <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>

<script type="text/x-red" data-help-name="interruptin">
    
    <p>InterruptIn ピンの入力をトリガーにフローを開始するノードです。</p>
    <p>また、payload にピンの value を代入します。</p>
    <p><code>{"payload": "high" or "low"}</code></p>
    <p>enebular の editor上では、ノード左部のボタンを押下することで、ノードの起動を行います。</p>

    <h3>Properties</h3>
    <ul>
        <li><code>pinName</code>： トリガーとする対象のピン名を指定</li>
        <li><code>mode</code>： プラットフォームにあわせて、<code>Pull Up</code>|<code>Pull Down</code>|<code>Pull None</code> を指定</li>
        <li><code>trigger</code>： 立ち上がり(rise) | 立ち下がり(fall) のトリガー設定</li>
    </ul>
  </script>